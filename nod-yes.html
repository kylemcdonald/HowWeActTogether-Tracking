<html>
<head>
  <meta charset="UTF-8">
  <title>Nod Yes</title>
  <script src="js/local/p5.js"></script>
  <script src="js/local/p5.dom.js"></script>
  <script src="js/local/lodash.js"></script>
  <script src="js/local/dat.gui.min.js"></script>

  <script src="js/utils.js"></script>
  <script src="js/ratetimer.js"></script>
  <script src="js/flow.js"></script>
  <script src="js/detector.js"></script>
  <script src="js/noddetector.js"></script>
  <script src="js/camera.js"></script>
  <script src="js/hysteresis.js"></script>
  <script src="js/graph.js"></script>

  <style>*{font-family: sans-serif;}</style>
</head>
<body>
<h1 style='opacity:0.1' id='act'>Nod Yes</h1>
<script>
var cam;
var detector;
var hys;

var w = 640, h = 480;

function newFrame(cam) {
  image(cam.capture, 0, 0);
  var detected = detector.update(cam.previousPixels, cam.currentPixels, cam.width, cam.height);
  if(detected) {
    console.log('nod');
  }
}

function setup() {
  createCanvas(w, h);
  detector = new NodDetector();
  cam = new Camera(w, h, newFrame);
  hys = new Hysteresis(1);
  hys.onBegin = function () {
    console.log('begin');
  }
  hys.onEnd = function () {
    console.log('end');
  }
}

function draw() {
  var status = hys.update(detector.getStatus());
  var opacity = status ? 1 : .1;
  select('#act').style('opacity', opacity);
}
</script>
</body>
</html>